---
title: 'LA-5: Examining and Managing Data (10 points)'
pagetitle: "COMM 3710: LA-5"
output:
  html_document:
    toc: true
    toc_float: true
    theme: flatly
urlcolor: blue
---

```{r setup, include=FALSE}
library(tidyverse)
library(summarytools)
hdata <- read.csv("HELP.csv")
knitr::opts_chunk$set(echo = FALSE)
```
In this assignment, you will learn how to:

- Run and examine frequency distributions using the `freq()` function in the `summarytools` package.
- View descriptive statistics using the `descr()` function in the `summarytools` package.
- Recoding variables using the `case_when()` function.
- Create new variables from existing variables in a data frame using the `mutate()` function.

> Remember to ...
>
> 1) Set up your R script as you did in LA-4.
> 2) Include a comment for each line of code in your R script. This can be pseudocode or other comments.

---

# Step 1 {.tabset .tabset-fade}
## Instructions

Load the packages below into R. Then, read the [HELP](https://utah.instructure.com/files/117853074/download?download_frd=1) data set into R. This data set is saved as a .csv file.

Packages to load:

- `tidyverse`
- `magrittr`
- `summarytools`
- `rstatix`

## Hint

See LA-4 for a reminder of how to load data into R, which involves using the function, `read_csv()`.

## Codebook

| Variable Name | Description |
| :------------ | :---------- |
| `age` | Subject age at baseline |
| `anysub` | Use of any substance post-detox (no, yes) |
| `cesd` | Center for Epidemiologic Studies Depression measure at baseline (high scores indicate more depressive symptoms) |
| `d1` | Lifetime number of hospitalizations for medical problems (measured at baseline) |
| `daysanysub` | Time (in days) to first use of any substance post-detox |
| `dayslink` | Time (in days) to linkage to primary care |
| `drugrisk` | Risk Assessment Battery drug risk scale at baseline |
| `e2b` | Number of times in past 6 months entered a detox program (measured at baseline) |
| `female` | Biological sex (0 = male, 1 = female) |
| `sex` | Biological sex (male, female)  |
| `g1b` | Experienced serious thoughts of suicide in last 30 days (measured at baseline; no, yes) |
| `homeless` | Housing status (housed, homeless) |
| `i1` | Average number of drinks consumed per day in past 30 days (measured at baseline) |
| `i2` | Maximum number of drinks consumed per day in past 30 days (measured at baseline) |
| `id` | Subject identifier |
| `indtot` | Inventory of Drug Use Consequences (InDUC) total score (measured at baseline) |
| `linkstatus` | Post-detox linkage to primary care (0 = no, 1 = yes) |
| `link` | Post-detox linkage to primary care (no, yes) |
| `mcs` | SF-36 Mental Component Score (measured at baseline; lower scores indicate worse status) |
| `pcs` | SF-36 Physical Component Score (measured at baseline; lower scores indicate worse status) |
| `pss_fr` | Perceived social support by friends (measured at baseline; higher scores indicate more support) |
| `racegrp` | Race/Ethnicity (black, hispanic, white, other) |
| `satreat` | Any BSAS substance abuse treatment at baseline (no, yes) |
| `sexrisk` | Risk Assessment battery; sex risk score (measured at baseline; high scores indicates higher risk) |
| `substance` | Primary substance of abuse (alcohol, cocaine, heroin) |
| `treat` | Randomized to HELP clinic (no, yes) |


# Step 2 {.tabset .tabset-fade}
## Instructions

Examine the frequency distributions of the variables, `sex` and `d1`. Use these frequency distributions to answer the questions below.

a. How many patients in the study are female?
b. How many patients in the study have never been hospitalized for medical problems?
c. What percentage of patients in the study have been hospitalized fewer than 5 times (i.e., 4 or fewer)?

## Hint

To run a frequency distribution, which creates a frequency table, you will need the `freq()` function in the `summarytools` package. Remember that you can read the documentation for a specific function by typing the function name preceded by `?` in the Console in RStudio. 

Read the documentation for `freq()` by typing `?freq` in the Console.

You might find the [section on working with data frames](https://sarakyeo.github.io/COMM-3710-bookdown/docs/start.html#working-with-data-frames) helpful.

Run the code below to see a frequency distribution for the variable `racegrp` in the HELP data set, which has been read into a data frame called `hdata`.

```{r freq, eval=FALSE, echo=TRUE}
hdata %>% 
        freq(racegrp) # examine freq dist of variable, racegrp
```


# Step 3 {.tabset .tabset-fade}
## Instructions
Now, subset the data to only include patients whose primary substance of abuse is cocaine and who are at least 40 years old. Then, examine the frequency distribution of `age`.

a. How many patients are at least 40 years old whose primary substance of abuse is cocaine?

## Hint
The code below subsets the data to include only patients who are housed (we did this in LA-4, if you need a reminder). To ensure that the subset of data has been created correctly, you can use the the `freq()` function. Change the code to filter the data to include only patients who are male.

```{r filter, eval=FALSE, echo=TRUE}
# Select respondents who are housed into a data frame called subdata
subdata <- hdata %>% 
        filter(homeless == "housed")

# Check that the code to filter data is correct...
subdata %>% 
        freq(homeless) # by examining a frequency distribution of the variable, homeless
```


# Step 4 
Examine a frequency table of `sex` based on this subset. Answer the questions below.

a. How many patients in the study are at least 40 years old and have cocaine listed as his/her primary abuse substance?
b. What percentage of patients who are at least 40 years old and have cocaine listed as his/her primary abuse substance are **male**?


# Step 5 {.tabset .tabset-fade}
## Instructions
Often, we want to look at descriptive statistics of a quantitative variable. We can do this using the `descr()` function that is in the package, `summarytools`. Let's examine descriptive statistics for the variable, `e2b`, which is the number of times in the past 6 months that the respondent entered a detox program.

Examine the descriptive statistics for `e2b` and answer the questions below.

a) What is the mean?
b) What is the median?
c) What is the maximum?

## Hint
Let's say I am interested in examining descriptive statistics of the quantitative variable, `pss_fr`, which is perceived social support by friends.

To do so, I would use the following code:
```{r descr, eval=FALSE, echo=TRUE}
hdata %>% 
  descr(pss_fr) # examine descriptive stats of variable, pss_fr
```     


# Step 6 {.tabset .tabset-fade}
## Instructions
We will now learn how to use the `mutate()` function to create a new variable from existing ones. We will use the variables, `daysanysub` and `dayslink`.

Create a new variable called `Mdays` that is the mean of `daysanysub` and `dayslink`. Then, examine the descriptive statistics of the new variable, `Mdays`, and answer the following questions.

a) What is the mean of the variable, `Mdays`?
b) What is the minimum value of `Mdays`? 
c) What is the maximum value of `Mdays`?

## Hint
To create a new variable, we need to first look at the frequency distributions of each variable that makes up the new variable you will create. In general, it is good practice to examine the frequency distributions of all variables before working with them.

Start by examining the variables that we will use:
```{r mutate1, eval=FALSE, echo=TRUE}
hdata %>% 
  freq(daysanysub) # examine freq dist of daysanysub

hdata %>% 
  freq(dayslink) # examine freq dist of dayslink
```

Then, we can create a new variable using the `mutate()` function. Note the use of the left arrow *and* the pipe operator. This is important as it tells R to save the new variable in the existing data frame, `hdata`.
```{r mutate2, eval=FALSE, echo=TRUE}
hdata <- hdata %>% # including the <- saves the new variable back into the data frame
  mutate(sumdays = daysanysub + dayslink) # sum the two variables

# Check that the new variable is correctly created
hdata %>% 
  freq(sumdays) # examine freq distribution of new variable, sumdays
```


# Step 7 {.tabset .tabset-fade}
## Instructions
There are times when we may want to take continuous variables and make them into categorical variables. For example, assume we are interested in respondents' depression scores, `cesd`, but we want to categorize them into low and high depression scores.

We refer to this process as **recoding variables**. For this exercise, let's say we want to code respondents who have scores of 30 or lower into a low category and those who have scores higher than 30 into a high category.

Use the `mutate()` and `case_when()` functions to recode `cesd` into a new variable, `dcesd`, with only two categories, low ($\le$ 30) and high (> 30).

Then, answer the following questions.

a) How many respondents are in the **low** category of the new variable, `dcesd`?
b) How many respondents are in the **high** category of the new variable, `dcesd`?

## Hint
To recode a variable, we will use the `mutate()` and `case_when()` functions. As an example, we will recode `i1` into a new variable, `di1`, that have low and high categories.
```{r recoding, echo=TRUE, eval=FALSE}
# First, examine the frequency distribution of i1
hdata %>% 
  freq(i1)

# Assume I want to categorize people who have 12 or fewer drinks into a low
# category and the rest into the high category (note the arrow and %>%)
hdata <- hdata %>% 
  mutate(di1 = case_when(i1 <= 12 ~ "low",
                         i1 > 12 ~ "high"))

# Check that the new variable has been recoded correctly
hdata %>% 
  freq(di1)
```


# Submission
Submit your R script (`LA-5_FirstName-LastName.R`) to Canvas.

Your R script should:

1) Include code to install and load the packages.
2) Include code to set your working directory.
3) Contain comments and/or pseudocode for every single line of R code.
4) Run in its entirety without errors.

To ensure that your R script runs without errors, you should:

- Save your script.
- Completely shut down RStudio or restart your R session.
- Reopen RStudio, open your `LA-5_FirstName-LastName.R` script.
- Run the entire script by clicking the "Run" button in the top right of the R script.

> These standards apply to all submissions in this course that require R scripts.

