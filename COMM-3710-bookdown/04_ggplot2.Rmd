# Plotting with `ggplot2` {#ggplot2}

This chapter covers the basics of plotting with the package, `ggplot2`. This package is contained within a collection of R packages designed for data science known as the [tidyverse](https://www.tidyverse.org/).

The core tidyverse includes packages that we use in everyday data analysis, including:

- `ggplot2`
- `dplyr`
- `tibble`

To learn more about the tidyverse, visit [tidyverse.org](https://www.tidyverse.org/).

To start working with graphs, first install and load the required package. Remember that you only have to install the package once (see Section \@ref(packages) to review R packages). 
```{r, eval=FALSE, prompt=TRUE}
install.packages("tidyverse") # you may not need this command
library(tidyverse)
```

```{r include = FALSE}
library(tidyverse) 
```

---

## `ggplot2` basics 

Building `ggplot` graphics is typically a layered process. The function that we use is `ggplot()`. We use the `+` to add layers to the function.

In the function arguments (i.e., the commands within the parentheses), we define the data set that we want to use with `data = `, the aesthetics (x- and y-axes) with `aes()`, and the type of graph with `geom`.

In the steps below, we will build the command sequentially. The `ggplot()` function will not run until the basic layers are in place. 

### Step 1. Specify data frame

Use the `data = ` argument to specify the data frame you are using to build the plot. Note that the word "data" in `(data = )` is an argument and should not be replaced. For example, if your data frame is named `utilities`, this line will be `ggplot(data = utilities)`.
``` {r, eval = FALSE, prompt=TRUE}
ggplot(data = dataframe_name) 
```

### Step 2. Specify x- and y-axes

Next, use `aes()` to tell R which variable to place on the x- (`x_var`) and y-axes (`y_var`). Note that you are adding this argument within the parentheses of the function, `ggplot()`. Be sure to close all parentheses--not doing so is a common error in R.
``` {r, eval = FALSE, prompt=TRUE}
ggplot(data = dataframe_name, aes(x = x_var, y = y_var))
```

If you are only working with only one variable (e.g., plotting a histogram of one variable), you need only specify the `x = ` variable within `aes()`.

### Step 3. Add geom

The third step is to tell R what type of graph to create--points, lines, bars, histograms, etc.--by adding the `geom` layer. This function is layered on to the `ggplot()` function  using the `+` sign.

For example, if we would like the relationship between two variables to be represented by a scatter plot, we can simply add `geom_point()`. 
``` {r eval = FALSE, prompt=TRUE}
ggplot(data = dataframe_name, aes(x = x_var, y = y_var)) + # note the + sign
         geom_point()
```

If we are plotting the histogram of one variable, we use `geom_histogram()`. 
``` {r eval = FALSE, prompt=TRUE}
ggplot(data = dataframe_name, aes(x = x_var)) + # note the + sign again
         geom_histogram()

## This is slightly different than the exact commands used in the video but
## more intuitive following the logic in this guide.
```

For a bar plot, we use `geom_bar()`.
``` {r eval = FALSE, prompt=TRUE}
ggplot(data = dataframe_name, aes(x = x_var)) + # note the + sign yet again
         geom_bar()
```

---

## Important considerations

The `+` sign used to add layers **must** be placed at the end of each line containing a layer. If the `+` sign is added in the line before the other layer, `ggplot2` will return an error message.
``` {r eval = FALSE, prompt=TRUE}
# This is the correct way of adding layers
ggplot( .... ) +
        geom_point()

# This will give you an error message
ggplot( .... ) 
       + geom_point()
```

```{r include = FALSE}
id <- 1: 120
quiz1 <- round(rnorm(120, m = 8.4, sd = .5), digits = 1)
quiz2 <- round(quiz1*0.9 + 0.3 + rnorm(120, m = 0, sd = .3), digits = 1)
quiz <- data.frame(id, quiz1, quiz2)

write.csv(quiz, file = "quiz.csv")
```

---

## An illustration

Let's create a graph with a fake data set ["quiz.csv"](http://yesuncomm.github.io/comm3710/files/quiz.csv). It contains the grades for Quiz 1 and Quiz 2 for 120 students (Data are simulated -- not real!). There are three variables: `id` (student id), `quiz1` (Grade for Quiz 1), and `quiz2` (grade for Quiz 2). 

First, make sure you set the working directory correctly on your computer and load the packages. 

Download this [data set](http://yesuncomm.github.io/comm3710/files/quiz.csv) and read it into your R. I'll just call this data frame `quiz`. 

```{r}
quiz <- read.csv("quiz.csv")
```

I'm interested in seeing the distribution of grades for Quiz 1, which calls for a histogram.  

To better understand what work R is doing step by step, you can run these lines one at a time and look at what happens in your RStudio "Plots" panel after each step. 

`ggplot(data = quiz)`   
`ggplot(data = quiz, aes(x = quiz1))`  
`ggplot(data = quiz, aes(x = quiz1)) + geom_histogram()`   


The complete command should be: 
```{r}
ggplot(data = quiz, aes(x = quiz1)) +
  geom_histogram()
```
  
  
You can do the same for Quiz 2 grades: 
```{r}
ggplot(data = quiz, aes(x = quiz2)) +
  geom_histogram()
```
  
What if we want to see whether there is a relationship between Quiz 1 and Quiz 2 scores? As you could imagine, these two should be positively correlated -- meaning that as one goes up, the other should also go up in general. We use a **scatterplot** to depict the relationship between two quantitative variables. 

```{r}
ggplot(data = quiz, aes(x = quiz1, y = quiz2)) +
  geom_point() 
```


Now I'm getting more ambitious -- let's label the two axes and add a title!

```{r}
ggplot(data = quiz, aes(x = quiz1, y = quiz2)) +
  geom_point() + 
  labs(x = 'Quiz 1 Grades', 
       y = 'Quiz 2 Grades',
       title = 'The Relationship b/t Quiz 1 and Quiz 2 Grades in COMM 3710')
```

---

## Additional resources for graphing

This guide includes only the basics of graphing with `ggplot2`. If you have questions that are not covered in this guide, the [R Graphics Cookbook](https://r-graphics.org/index.html) is a practical guide that provides recipes for quickly 

++
generating high-quality graphs.

